<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TEST WS LED</title>
</head>
<body>
  <h1>ğŸ’¡ Test WebSocket â€“ LED Rojo esp32_01</h1>

  <button id="btnToggleRed">ğŸ”´ Toggle LED Rojo</button>

  <p id="log"></p>

  <script src="/js/ws_client.js"></script>
  <script>
    const log = (msg) => {
      document.getElementById("log").innerHTML += msg + "<br>";
      console.log(msg);
    };

    // Escuchar actualizaciones del WS
    WSClient.on("device_update", (msg) => {
      log("ğŸ”” WS device_update recibido:");
      log(JSON.stringify(msg));
    });

    // BotÃ³n que envÃ­a comando al backend
    document.getElementById("btnToggleRed").onclick = async () => {
      log("ğŸ“¤ Enviando toggle LED rojo vÃ­a HTTP...");

      try {
        const res = await fetch("/api/devices/esp32_01/led/rojo", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + localStorage.getItem("token")
          }
        });

        const txt = await res.text();
        log("ğŸ”™ Respuesta backend: " + txt);
      } catch (e) {
        log("âŒ ERROR enviando comando: " + e);
      }
    };
  </script>

</body>
</html>
