<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>WS Test</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    #log { white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>WebSocket Test</h2>
  <div id="log"></div>
  <script>
    const log = txt => {
      const el = document.getElementById("log");
      el.textContent += txt + "\n";
    };

    const token = "<JWT_REAL>"; // <-- reemplazÃ¡ con token real
    const device = "esp32_01";
    const ws = new WebSocket(`ws://localhost:8080/ws?token=${token}&devices=${device}`);

    ws.onopen = () => log("âœ… Conectado al WS...");
    ws.onmessage = e => {
      log("ðŸ“¡ Mensaje: " + e.data);
      try {
        const msg = JSON.parse(e.data);
        if (msg.type === "status") {
          log(`ðŸŸ¢ Estado actualizado: ${JSON.stringify(msg.status)}`);
        }
      } catch (err) {
        log("âš ï¸ No se pudo parsear JSON");
      }
    };
    ws.onerror = e => log("âŒ Error WS: " + e.message);
    ws.onclose = () => log("ðŸ”Œ ConexiÃ³n cerrada");
  </script>
</body>
</html>
